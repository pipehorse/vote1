<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>우리집 가훈 이벤트</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 30px auto; text-align: center; }
    input, button, select { padding: 8px; margin: 5px; }
    .hidden { display: none; }
    .result { margin-top: 20px; text-align: left; }
  </style>
</head>
<body>
  <h1>우리집 가훈 이벤트</h1>

  <!-- 가훈 제안 -->
  <div id="submit-area">
    <p>닉네임과 가훈을 입력해주세요</p>
    <input id="nickname" placeholder="닉네임">
    <input id="motto" placeholder="가훈">
    <button onclick="submitMotto()">제출</button>
  </div>

  <!-- 투표 -->
  <div id="vote-area" class="hidden">
    <h2>가훈 투표하기</h2>
    <select id="vote-select"></select>
    <button onclick="submitVote()">투표</button>
  </div>

  <!-- 결과 -->
  <div id="result-area" class="hidden">
    <h2>투표 결과</h2>
    <div id="results"></div>
  </div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxdLSwvCjKgIULp7KnrEO8mJPBAsACe1xELCkubqKwRsKCei2dt1UlrgHTxmC5LsVF9/exec";

async function submitMotto() {
  const nick = document.getElementById("nickname").value.trim();
  const motto = document.getElementById("motto").value.trim();
  if (!nick || !motto) { alert("닉네임과 가훈을 입력하세요"); return; }

  await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({type: "submitMotto", nick, motto})
  });
  alert("제출 완료!");
  loadMottos();
}

async function loadMottos() {
  const res = await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({type: "getMottos"})
  });
  const mottos = await res.json();

  const sel = document.getElementById("vote-select");
  sel.innerHTML = "";
  mottos.forEach(m => {
    const opt = document.createElement("option");
    opt.value = m.row;
    opt.textContent = m.motto;
    sel.appendChild(opt);
  });

  document.getElementById("vote-area").classList.remove("hidden");

  // 결과 표시
  const resDiv = document.getElementById("results");
  resDiv.innerHTML = "";
  mottos.forEach(m => {
    const div = document.createElement("div");
    div.textContent = `"${m.motto}" → ${m.votes || 0}표`;
    resDiv.appendChild(div);
  });
  document.getElementById("result-area").classList.remove("hidden");
}

async function submitVote() {
  const row = document.getElementById("vote-select").value;
  await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({type: "submitVote", row})
  });
  alert("투표 완료!");
  loadMottos();
}

window.onload = loadMottos;
</script>
</body>
</html>
