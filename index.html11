<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>우리집 가훈 이벤트</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 30px auto; text-align: center; }
    input, button, select { padding: 8px; margin: 5px; }
    .hidden { display: none; }
    .result { margin-top: 20px; text-align: left; }
  </style>
</head>
<body>
  <h1>우리집 가훈 만들기</h1>

  <!-- Step 1: 가훈 제출 -->
  <div id="submit-area">
    <p>닉네임을 입력하고 가훈을 제안해주세요!</p>
    <input id="nickname" placeholder="닉네임">
    <input id="motto" placeholder="가훈">
    <button onclick="submitMotto()">제출</button>
  </div>

  <!-- Step 2: 투표 -->
  <div id="vote-area" class="hidden">
    <h2>가훈 투표하기</h2>
    <select id="vote-select"></select>
    <button onclick="submitVote()">투표</button>
  </div>

  <!-- Step 3: 결과 -->
  <div id="result-area" class="hidden">
    <h2>투표 결과</h2>
    <div id="results"></div>
  </div>

  <script>
    const mottos = JSON.parse(localStorage.getItem("mottos") || "[]");
    const votes = JSON.parse(localStorage.getItem("votes") || "{}");

    function submitMotto() {
      const nick = document.getElementById("nickname").value.trim();
      const motto = document.getElementById("motto").value.trim();
      if (!nick || !motto) { alert("닉네임과 가훈을 모두 입력해주세요!"); return; }

      mottos.push({nick, motto});
      localStorage.setItem("mottos", JSON.stringify(mottos));
      alert("가훈이 제출되었습니다!");

      // 제출창 닫고 투표로 이동
      document.getElementById("submit-area").classList.add("hidden");
      showVoteArea();
    }

    function showVoteArea() {
      const sel = document.getElementById("vote-select");
      sel.innerHTML = "";
      mottos.forEach((m, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = m.motto;
        sel.appendChild(opt);
      });
      document.getElementById("vote-area").classList.remove("hidden");
    }

    function submitVote() {
      const idx = document.getElementById("vote-select").value;
      votes[idx] = (votes[idx] || 0) + 1;
      localStorage.setItem("votes", JSON.stringify(votes));
      alert("투표 완료! 결과를 확인하세요.");

      document.getElementById("vote-area").classList.add("hidden");
      showResults();
    }

    function showResults() {
      const resDiv = document.getElementById("results");
      resDiv.innerHTML = "";
      mottos.forEach((m, i) => {
        const count = votes[i] || 0;
        const div = document.createElement("div");
        div.textContent = `"${m.motto}" → ${count}표`;
        resDiv.appendChild(div);
      });
      document.getElementById("result-area").classList.remove("hidden");
    }

    // 페이지 로드 시 상태 확인
    if (mottos.length > 0) {
      document.getElementById("submit-area").classList.add("hidden");
      showVoteArea();
    }
  </script>
</body>
</html>
